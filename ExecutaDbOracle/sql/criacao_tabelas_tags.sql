CREATE TABLE TJRJ.TJRJ_TAG_CUSTOMIZADA
(
	TACU_DK              NUMBER 			NOT NULL ,
	TACU_ORGI_DK         NUMBER 			NOT NULL ,
	TACU_DS_TAG          VARCHAR2(250) 		NOT NULL ,
	TACU_COR_TAG_HEXA    VARCHAR2(7) 		NOT NULL ,
	TACU_DT_INCLUSAO     DATE 				NOT NULL ,
	CONSTRAINT  TACU_PK PRIMARY KEY (TACU_DK)
);

CREATE UNIQUE INDEX TJRJ.TACU_DS_TAG_UK_I 
	ON TJRJ.TJRJ_TAG_CUSTOMIZADA (TACU_ORGI_DK   ASC, TACU_DS_TAG ASC);

ALTER TABLE TJRJ.TJRJ_TAG_CUSTOMIZADA
	ADD CONSTRAINT TACU_COR_TAG_HEXA_CK 
	CHECK 
	(
		LENGTH(TACU_COR_TAG_HEXA) = 7			AND 
		SUBSTR(TACU_COR_TAG_HEXA, 1, 1) = '#'	AND 
		INSTR(TACU_COR_TAG_HEXA, '.') = 0		AND  
		translate(SUBSTR(TACU_COR_TAG_HEXA, 2, 6), 
			'ABCDEF0123456789', '................') = '......' 
	);

ALTER TABLE TJRJ.TJRJ_TAG_CUSTOMIZADA
	ADD CONSTRAINT TACU_ORGI_FK FOREIGN KEY (TACU_ORGI_DK) REFERENCES ORGI.ORGI_ORGAO (ORGI_DK);

create sequence tjrj.tjrj_sq_tacu_dk;
grant select on tjrj.tjrj_sq_tacu_dk to RL_TJRJ_WEBSERV; 
grant select on tjrj.tjrj_sq_tacu_dk to RL_INTG_JUDI; 

GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_CUSTOMIZADA TO RL_TJRJ_WEBSERV; 
GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_CUSTOMIZADA to RL_INTG_JUDI; 

COMMENT ON TABLE TJRJ.TJRJ_TAG_CUSTOMIZADA IS 'Uma tag é uma etiqueta / rótulo que se pode aplicar, no Integra Judicial, a um processo ou aviso, de modo a facilitar a auto-organização das equipes. Por exemplo, podem ser criadas etiquetas marcando o que é prioritário, ou ainda o que é uma ciência ou um parecer.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_CUSTOMIZADA.TACU_DK IS 'Chave primária baseada em sequence.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_CUSTOMIZADA.TACU_DS_TAG IS 'Texto da Tag propriamente dita. Deve ser único, para um mesmo órgão.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_CUSTOMIZADA.TACU_COR_TAG_HEXA IS 'Cor a ser aplicada à Tag, utilizando valores hexadecimais. Ex: #FF00FF';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_CUSTOMIZADA.TACU_DT_INCLUSAO IS 'Data de inclusão deste registro.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_CUSTOMIZADA.TACU_ORGI_DK IS 'Fk para órgão (ORGI_DK).';

CREATE TABLE TJRJ.TJRJ_TAG_PROCESSO_AVISO
(
	TAPR_DK              NUMBER 		NOT NULL , 
	TAPR_TACU_DK         NUMBER 		NOT NULL , 
	TAPR_TJRA_DK         NUMBER 		NOT NULL , 
	TAPR_ORDENACAO       INTEGER 		NOT NULL , 
	TAPR_DT_INCLUSAO     DATE 			NOT NULL , 
	CONSTRAINT  TAPR_PK PRIMARY KEY (TAPR_DK)
);

CREATE UNIQUE INDEX TJRJ.TAPR_ASSOC_PROC_UK_I 
	ON TJRJ.TJRJ_TAG_PROCESSO_AVISO (TAPR_TJRA_DK   ASC, TAPR_TACU_DK ASC);

ALTER TABLE TJRJ.TJRJ_TAG_PROCESSO_AVISO
	ADD CONSTRAINT TAPR_TACU_FK FOREIGN KEY (TAPR_TACU_DK) REFERENCES TJRJ.TJRJ_TAG_CUSTOMIZADA (TACU_DK);

	CREATE  INDEX TJRJ.TAPR_TACU_FK_I ON TJRJ.TJRJ_TAG_PROCESSO_AVISO (TAPR_TACU_DK   ASC);

ALTER TABLE TJRJ.TJRJ_TAG_PROCESSO_AVISO
	ADD CONSTRAINT TAPR_TJRA_FK FOREIGN KEY (TAPR_TJRA_DK) REFERENCES TJRJ.TJRJ_PROCESSO_AVISO (TJRA_DK);

	CREATE  INDEX TJRJ.TAPR_TJRA_FK_I ON TJRJ.TJRJ_TAG_PROCESSO_AVISO (TAPR_TJRA_DK   ASC);

create sequence tjrj.tjrj_sq_tapr_dk;
grant select on tjrj.tjrj_sq_tapr_dk to RL_TJRJ_WEBSERV; 
grant select on tjrj.tjrj_sq_tapr_dk to RL_INTG_JUDI; 


GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_PROCESSO_AVISO TO RL_TJRJ_WEBSERV; 
GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_PROCESSO_AVISO to RL_INTG_JUDI; 

COMMENT ON TABLE TJRJ.TJRJ_TAG_PROCESSO_AVISO IS 'Representa a associação entre uma Tag (rótulo) e um processo do Integra Judicial.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_PROCESSO_AVISO.TAPR_TACU_DK IS 'FK para TJRJ_TAG_CUSTOMIZADA';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_PROCESSO_AVISO.TAPR_TJRA_DK IS 'FK para TJRJ_PROCESSO_AVISO';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_PROCESSO_AVISO.TAPR_DK IS 'Chave primária baseada em sequence.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_PROCESSO_AVISO.TAPR_DT_INCLUSAO IS 'Data de inclusão deste registro.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_PROCESSO_AVISO.TAPR_ORDENACAO IS 'Campo usado para a ordenação das tags na exibição.';

CREATE TABLE TJRJ.TJRJ_TAG_AVISO
(
	TAAV_DK              NUMBER 		NOT NULL 	, 
	TAAV_TACU_DK         NUMBER 		NOT NULL 	, 
	TAAV_AVCI_DK         NUMBER 		NOT NULL 	, 
	TAAV_ORDENACAO       INTEGER 		NOT NULL 	, 
	TAAV_DT_INCLUSAO     DATE 			NOT NULL 	, 
	CONSTRAINT  TAAV_PK PRIMARY KEY (TAAV_DK)
);

CREATE UNIQUE INDEX TJRJ.TAAV_ASSOC_AVISO_UK_I 
	ON TJRJ.TJRJ_TAG_AVISO (TAAV_AVCI_DK   ASC, TAAV_TACU_DK ASC);

ALTER TABLE TJRJ.TJRJ_TAG_AVISO
	ADD CONSTRAINT TAAV_TACU_FK FOREIGN KEY (TAAV_TACU_DK) REFERENCES TJRJ.TJRJ_TAG_CUSTOMIZADA (TACU_DK);

	CREATE  INDEX TJRJ.TAAV_TACU_FK_I ON TJRJ.TJRJ_TAG_AVISO (TAAV_TACU_DK   ASC);

ALTER TABLE TJRJ.TJRJ_TAG_AVISO
	ADD CONSTRAINT TAAV_AVCI_FK FOREIGN KEY (TAAV_AVCI_DK) REFERENCES TJRJ.TJRJ_AVISO_COMUNIC_INTIMACAO (AVCI_DK);

	CREATE  INDEX TJRJ.TAAV_AVCI_FK_I ON TJRJ.TJRJ_TAG_AVISO (TAAV_AVCI_DK   ASC);

create sequence tjrj.tjrj_sq_taav_dk;
grant select on tjrj.tjrj_sq_taav_dk to RL_TJRJ_WEBSERV; 
grant select on tjrj.tjrj_sq_tapr_dk to RL_INTG_JUDI; 

GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_AVISO TO RL_TJRJ_WEBSERV; 
GRANT DELETE, INSERT, SELECT, UPDATE ON tjrj.TJRJ_TAG_AVISO to RL_INTG_JUDI; 

COMMENT ON TABLE TJRJ.TJRJ_TAG_AVISO IS 'Representa a associação entre uma Tag (rótulo) e um aviso do Integra Judicial.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_AVISO.TAAV_TACU_DK IS 'FK para TJRJ_TAG_CUSTOMIZADA';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_AVISO.TAAV_AVCI_DK IS 'FK para TJRJ_AVISO_COMUNIC_INTIMACAO';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_AVISO.TAAV_DK IS 'Chave primária baseada em sequence.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_AVISO.TAAV_ORDENACAO IS 'Campo usado para a ordenação das tags na exibição.';
COMMENT ON COLUMN TJRJ.TJRJ_TAG_AVISO.TAAV_DT_INCLUSAO IS 'Data de inclusão deste registro.';
